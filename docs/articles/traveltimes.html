<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Travel Times â€¢ gtfsrouter</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Travel Times">
<meta property="og:description" content="gtfsrouter">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gtfsrouter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.5.149</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ATFutures/gtfs-router" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Travel Times</h1>
                        <h4 data-toc-skip class="author">Mark Padgham
&amp; Alexandra Kapp</h4>
            
            <h4 data-toc-skip class="date">2023-03-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ATFutures/gtfs-router/blob/HEAD/vignettes/traveltimes.Rmd" class="external-link"><code>vignettes/traveltimes.Rmd</code></a></small>
      <div class="hidden name"><code>traveltimes.Rmd</code></div>

    </div>

    
    
<p><code>gtfsrouter</code> includes a function, <a href="https://atfutures.github.io/gtfs-router/reference/gtfs_traveltimes.html" class="external-link"><code>gtfs_traveltimes()</code></a>,
to efficiently calculate travel times from a nominated station to all
other stations within a GTFS feed. The function takes only two main
parameters, the first specifying a departure station, and the second
specifying a pair of <code>start_time_limits</code> determining the
earliest and latest possible departure times from that station. The
function will then return the fastest connections to all possible end
stations for services departing within the specified
<code>start_time_limits</code>.</p>
<p>For example, travel times to all stations for services leaving a
nominated station between 12:00 and 13:00 can be extracted by specifying
<code>start_time_limits = c (12, 13) * 3600</code>. The following code
uses the internal Berlin data to demonstrate, starting by reading the
GTFS data and constructing a timetable for a specified day. This second
step, achieved by calling the <a href="https://atfutures.github.io/gtfs-router/reference/gtfs_timetable.html" class="external-link"><code>gtfs_timetable()</code>
function</a>, is necessary prior to calculating travel times.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://github.com/ATFutures/gtfs-router" class="external-link">gtfsrouter</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/berlin_gtfs_to_zip.html">berlin_gtfs_to_zip</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/tmp/RtmpHu26Nl/vbb.zip"</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span> <span class="op">(</span><span class="op">)</span>, <span class="st">"vbb.zip"</span><span class="op">)</span></span>
<span><span class="va">gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_gtfs.html">extract_gtfs</a></span> <span class="op">(</span><span class="va">f</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gtfs_timetable.html">gtfs_timetable</a></span> <span class="op">(</span><span class="va">gtfs</span>, day <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>The <a href="https://atfutures.github.io/gtfs-router/reference/gtfs_traveltimes.html" class="external-link"><code>gtfs_traveltimes()</code></a>,
function may then be called by specifying a start station
(<code>from</code>), and <code>start_time_limits</code>, as in the
following code:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">from</span> <span class="op">&lt;-</span> <span class="st">"Alexanderplatz"</span></span>
<span><span class="va">start_time_limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">12</span>, <span class="fl">13</span><span class="op">)</span> <span class="op">*</span> <span class="fl">3600</span></span>
<span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gtfs_traveltimes.html">gtfs_traveltimes</a></span><span class="op">(</span><span class="va">gtfs</span>,</span>
<span>                       from <span class="op">=</span> <span class="va">from</span>,</span>
<span>                       start_time_limits <span class="op">=</span> <span class="va">start_time_limits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   start_time duration ntransfers      stop_id               stop_name stop_lon</span></span>
<span><span class="co">## 1   12:00:42 00:14:42          1 060003102223     S Bellevue (Berlin) 13.34710</span></span>
<span><span class="co">## 2   12:00:42 00:08:36          0 060003102224     S Bellevue (Berlin) 13.34710</span></span>
<span><span class="co">## 3   12:00:42 00:15:06          1 060003103233   S Tiergarten (Berlin) 13.33624</span></span>
<span><span class="co">## 4   12:00:42 00:10:42          0 060003103234   S Tiergarten (Berlin) 13.33624</span></span>
<span><span class="co">## 5   12:00:42 00:14:18          1 060003201213 S+U Berlin Hauptbahnhof 13.36892</span></span>
<span><span class="co">## 6   12:00:42 00:05:54          0 060003201214 S+U Berlin Hauptbahnhof 13.36892</span></span>
<span><span class="co">##   stop_lat</span></span>
<span><span class="co">## 1 52.51995</span></span>
<span><span class="co">## 2 52.51995</span></span>
<span><span class="co">## 3 52.51396</span></span>
<span><span class="co">## 4 52.51396</span></span>
<span><span class="co">## 5 52.52585</span></span>
<span><span class="co">## 6 52.52585</span></span></code></pre>
<p>The function returns a <code>data.frame</code> in which each row
details the fastest connection to each station, in terms of the start
time and duration of that trip, as well as the number of transfers
necessary.</p>
<div class="section level2">
<h2 id="maximum-traveltimes">Maximum Traveltimes<a class="anchor" aria-label="anchor" href="#maximum-traveltimes"></a>
</h2>
<p>The previous code returns a <code>data.frame</code> detailing
traveltimes for the following stations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">tt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 689</span></span></code></pre>
<p>This relatively low number is because the <a href="https://atfutures.github.io/gtfs-router/reference/berlin_gtfs_to_zip.html" class="external-link"><code>berlin_gtfs_to_zip()</code>
function</a> creates only a small sample portion of a full feed,
extending over only one hour and containing a small number of stations.
The total number of stations reachable from the Alexanderplatz station
during these times are:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">gtfs</span><span class="op">$</span><span class="va">stops</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 957</span></span></code></pre>
<p>The <a href="https://atfutures.github.io/gtfs-router/reference/gtfs_traveltimes.html" class="external-link"><code>gtfs_traveltimes()</code></a>,
returns travel times to only a subset of all potentially reachable
stations (689 instead of 957) for two main reasons. First, not all
stations may actually be reachable from a given station, and travel
times will only be returned for those that are. Secondly, the <a href="https://atfutures.github.io/gtfs-router/reference/gtfs_traveltimes.html" class="external-link"><code>gtfs_traveltimes()</code></a>,
function has an additional parameter, <code>max_traveltime</code>, and
only returns travel times to stations able to be reached within this
upper limit. The default value is 3600, or one hour. For the token feed
used here, the maximum travel times returned are:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hms</span><span class="fu">::</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html" class="external-link">hms</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span> <span class="op">(</span><span class="va">tt</span><span class="op">$</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 00:58:00</span></span></code></pre>
<p>In this case that value actually reflects the restricted data
included in the sample data set, but applying the function to an actual
GTFS feed will by default record traveltimes to all stations reachable
within one hour. The following shows a more realistic example using a
full version of the Berlin GTFS data:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_gtfs.html">extract_gtfs</a></span> <span class="op">(</span><span class="st">"/&lt;path&gt;/&lt;to&gt;/vbb.zip"</span><span class="op">)</span></span>
<span><span class="va">gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gtfs_timetable.html">gtfs_timetable</a></span> <span class="op">(</span><span class="va">gtfs</span>, day <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gtfs_traveltimes.html">gtfs_traveltimes</a></span> <span class="op">(</span><span class="va">gtfs</span>,</span>
<span>                        from <span class="op">=</span> <span class="va">from</span>,</span>
<span>                        start_time_limits <span class="op">=</span> <span class="va">start_time_limits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">tt</span><span class="op">)</span>; <span class="fu">hms</span><span class="fu">::</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html" class="external-link">hms</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span> <span class="op">(</span><span class="va">tt</span><span class="op">$</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 8556</span></span>
<span><span class="co">## 01:00:00</span></span></code></pre></div>
<p>The number of stations reached in the full feed is far more, and the
maximum trip duration is indeed precisely one hour. This parameter of
<code>max_traveltime</code> defaults to the relatively short value of
one hour because calculation times increase non-linearly with numbers of
stations reached. The following graphs show calculation times as a
function both of <code>max_traveltime</code>, and numbers of stations
reached.</p>
<details><summary>
Click one the arrow to the left to see code used to generate these
results
</summary><p>
</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maxt</span> <span class="op">&lt;-</span> <span class="fl">3600</span> <span class="op">+</span> <span class="fl">0</span><span class="op">:</span><span class="fl">10</span> <span class="op">*</span> <span class="fl">1800</span> <span class="co"># 1-6 hours in half-hour intervals</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span> <span class="op">(</span><span class="va">maxt</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span> <span class="op">(</span></span>
<span>                <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gtfs_traveltimes.html">gtfs_traveltimes</a></span> <span class="op">(</span><span class="va">gtfs</span>,</span>
<span>                                         from <span class="op">=</span> <span class="va">from</span>,</span>
<span>                                         start_time_limits <span class="op">=</span> <span class="va">start_time_limits</span>,</span>
<span>                                         max_traveltime <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span>                <span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="va">st</span> <span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span> <span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span> <span class="op">(</span>max_time <span class="op">=</span> <span class="va">maxt</span> <span class="op">/</span> <span class="fl">3600</span>, <span class="co"># in hours</span></span>
<span>                   calc_time <span class="op">=</span> <span class="va">dat</span> <span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,</span>
<span>                   n_stns <span class="op">=</span> <span class="va">dat</span> <span class="op">[</span><span class="fl">2</span>, <span class="op">]</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span> <span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">max_time</span>, <span class="va">dat</span><span class="op">$</span><span class="va">calc_time</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>      xlab <span class="op">=</span> <span class="st">"Max Traveltime (hours)"</span>,</span>
<span>      ylab <span class="op">=</span> <span class="st">"Calculation Time (seconds)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">max_time</span>, <span class="va">dat</span><span class="op">$</span><span class="va">calc_time</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">n_stns</span>, <span class="va">dat</span><span class="op">$</span><span class="va">calc_time</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>      xlab <span class="op">=</span> <span class="st">"Thousands of Stations Reached"</span>,</span>
<span>      ylab <span class="op">=</span> <span class="st">"Calculation Time (seconds)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">n_stns</span>, <span class="va">dat</span><span class="op">$</span><span class="va">calc_time</span><span class="op">)</span></span></code></pre></div>

</details><p><br></p>
<p><img src="traveltimes_files/figure-html/timing-manual-1.png" width="700"></p>
<p>Those graphs show that increasing the <code>max_traveltime</code>
parameter leads to approximately linear increases in the calculation
times required for <a href="https://atfutures.github.io/gtfs-router/reference/gtfs_traveltimes.html" class="external-link"><code>gtfs_traveltimes()</code></a>,
to execute, while relationships with numbers of stations actually
reached are highly non-linear. The panel on the right side shows that
increases in <code>max_traveltime</code> eventually have little effect
on increasing numbers of stations reached, yet increases computation
times considerably. Values for <code>max_traveltime</code> should
accordingly only be adjusted after first determining appropriate values.
In particular, note that although the Berlin GTFS has a large number of
distinct stops:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">gtfs</span><span class="op">$</span><span class="va">stops</span><span class="op">)</span></span>
<span><span class="co">## [1] 41577</span></span></code></pre></div>
<p>Many of these reflect <code>stop_id</code> values for multiple
platforms at a single station. The number of distinct stop names is in
fact much less:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span> <span class="op">(</span><span class="va">gtfs</span><span class="op">$</span><span class="va">stops</span><span class="op">$</span><span class="va">stop_name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 13090</span></span></code></pre></div>
<p>A rule-of-thumb is to increase the <code>max_traveltime</code>
parameter until the number of stations reached exceeds by some small
amount the total number of actual stops in a system. In the case of
these Berlin data, a maximum traveltime of 2 hours is sufficient.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="fu"><a href="../reference/gtfs_traveltimes.html">gtfs_traveltimes</a></span> <span class="op">(</span><span class="va">gtfs</span>,</span>
<span>                        from <span class="op">=</span> <span class="va">from</span>,</span>
<span>                        start_time_limits <span class="op">=</span> <span class="va">start_time_limits</span>,</span>
<span>                        max_traveltime <span class="op">=</span> <span class="fl">7200</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 15989</span></span></code></pre></div>
<p>These additional stations reached naturally tend to be stations on
the periphery of the system, while doubling the
<code>max_traveltime</code> parameter approximately doubles the
calculation time (in this case, according to the graphs shown above).
Appropriate values will depend on the nature of desired results.
Analyses focussed on more central parts of a system can use smaller
values, with shorter corresponding calculation times. Analyses for which
peripheral stations are important may need to use larger values of
<code>max_traveltimes</code>, yet should do so carefully to avoid undue
increases in calculation times.</p>
</div>
<div class="section level2">
<h2 id="fastest-routes-versus-minimal-transfer-routes">Fastest Routes versus Minimal-Transfer Routes<a class="anchor" aria-label="anchor" href="#fastest-routes-versus-minimal-transfer-routes"></a>
</h2>
<p>The <a href="https://atfutures.github.io/gtfs-router/reference/gtfs_traveltimes.html" class="external-link"><code>gtfs_traveltimes()</code></a>,
function has an additional parameter, <code>minimise_transfers</code>,
which can be used to return either the fastest possible connections from
a start station to all other reachable stations within a system, or the
fastest connection which has the least possible number of transfers.
Connections with the least transfers may be slower than fastest possible
connections, as shown by the following analysis.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tt_fastest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gtfs_traveltimes.html">gtfs_traveltimes</a></span> <span class="op">(</span><span class="va">gtfs</span>,</span>
<span>                                from <span class="op">=</span> <span class="va">from</span>,</span>
<span>                                start_time_limits <span class="op">=</span> <span class="va">start_time_limits</span><span class="op">)</span></span>
<span><span class="va">tt_min_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gtfs_traveltimes.html">gtfs_traveltimes</a></span> <span class="op">(</span><span class="va">gtfs</span>,</span>
<span>                               from <span class="op">=</span> <span class="va">from</span>,</span>
<span>                               start_time_limits <span class="op">=</span> <span class="va">start_time_limits</span>,</span>
<span>                               minimise_transfers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># non-dplyr join:</span></span>
<span><span class="va">tt_fastest</span> <span class="op">&lt;-</span> <span class="va">tt_fastest</span> <span class="op">[</span><span class="va">tt_fastest</span><span class="op">$</span><span class="va">stop_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">tt_min_tr</span><span class="op">$</span><span class="va">stop_id</span>, <span class="op">]</span></span>
<span><span class="va">tt_min_tr</span> <span class="op">&lt;-</span> <span class="va">tt_min_tr</span> <span class="op">[</span><span class="va">tt_min_tr</span><span class="op">$</span><span class="va">stop_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">tt_fastest</span><span class="op">$</span><span class="va">stop_id</span>, <span class="op">]</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span> <span class="op">(</span>stop_id <span class="op">=</span> <span class="va">tt_fastest</span><span class="op">$</span><span class="va">stop_id</span>,</span>
<span>                   fastest_dur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span> <span class="op">(</span><span class="va">tt_fastest</span><span class="op">$</span><span class="va">duration</span> <span class="op">/</span> <span class="fl">3600</span><span class="op">)</span>, <span class="co"># hours</span></span>
<span>                   fastest_ntr <span class="op">=</span> <span class="va">tt_fastest</span><span class="op">$</span><span class="va">ntransfers</span>,</span>
<span>                   min_tr_dur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span> <span class="op">(</span><span class="va">tt_min_tr</span><span class="op">$</span><span class="va">duration</span> <span class="op">/</span> <span class="fl">3600</span><span class="op">)</span>,</span>
<span>                   min_tr_ntr <span class="op">=</span> <span class="va">tt_min_tr</span><span class="op">$</span><span class="va">ntransfers</span><span class="op">)</span></span>
<span></span>
<span><span class="fl">60</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">min_tr_dur</span> <span class="op">-</span> <span class="va">dat</span><span class="op">$</span><span class="va">fastest_dur</span><span class="op">)</span> <span class="co"># in minutes</span></span>
<span><span class="co">## [1] 3.957052</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">fastest_ntr</span> <span class="op">-</span> <span class="va">dat</span><span class="op">$</span><span class="va">min_tr_ntr</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.2818428</span></span></code></pre></div>
<p>Minimal-transfer trips take on average just under 4 minutes longer,
while requiring 0.28 fewer trips. Most fastest trips are nevertheless
also minimal-transfer trips, as can be seen by the number of identical
values returned by these two queries.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">min_tr_ntr</span> <span class="op">==</span> <span class="va">dat</span><span class="op">$</span><span class="va">fastest_ntr</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.6875221</span></span></code></pre></div>
<p>So almost 70% of faster trips are also trips with fewest number of
transfers, with around 30% of fastest trips involving more than the
minimal possible number of transfers.</p>
</div>
<div class="section level2">
<h2 id="the-traveltimes-algorithm">The Traveltimes Algorithm<a class="anchor" aria-label="anchor" href="#the-traveltimes-algorithm"></a>
</h2>
<p>The <a href="https://atfutures.github.io/gtfs-router/reference/gtfs_traveltimes.html" class="external-link"><code>gtfs_traveltimes()</code></a>,
is based on a new algorithm specifically developed for this package, and
which will be described here in further detail in subsequent releases of
the package.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mark Padgham, Marcin Stepniak.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
